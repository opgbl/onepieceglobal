const $=s=>document.querySelector(s);const status=$("#status");const loginBtn=$("#login");const logoutBtn=$("#logout");const pwd=$("#password");const loginMsg=$("#loginMsg");const createBtn=$("#create");const createMsg=$("#createMsg");const titleIn=$("#title");const qualitiesIn=$("#qualities");const whoamiBtn=$("#whoami");const whoamiOut=$("#whoamiOut");const KEY="opg_admin_token";function token(){return localStorage.getItem(KEY)}function setToken(t){t?localStorage.setItem(KEY,t):localStorage.removeItem(KEY);updateUI()}function isAuthed(){return!!token()}function updateUI(){if(isAuthed()){status.textContent="Autenticado";logoutBtn.style.display="inline-block"}else{status.textContent="No autenticado";logoutBtn.style.display="none"}}async function login(){loginMsg.textContent="";try{const res=await fetch(API_URL+"/api/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:pwd.value})});const data=await res.json();if(!res.ok)throw new Error(data?.error||"Error de login");setToken(data.token);loginMsg.style.color="#86efac";loginMsg.textContent="Login correcto."}catch(e){loginMsg.style.color="#fca5a5";loginMsg.textContent=e.message}}async function whoami(){whoamiOut.textContent="";try{const res=await fetch(API_URL+"/api/admin/me",{headers:{Authorization:"Bearer "+token()}});const data=await res.json();whoamiOut.textContent=JSON.stringify(data,null,2)}catch(e){whoamiOut.textContent=e.message}}async function createEpisode(){createMsg.textContent="";if(!isAuthed()){createMsg.style.color="#fca5a5";createMsg.textContent="Primero inicia sesiÃ³n.";return}try{const qualities=qualitiesIn.value.split(",").map(s=>s.trim()).filter(Boolean);const res=await fetch(API_URL+"/api/admin/episodes",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+token()},body:JSON.stringify({title:titleIn.value,quality:qualities})});const data=await res.json();if(!res.ok)throw new Error(data?.error||"Error al crear");createMsg.style.color="#86efac";createMsg.textContent="Creado: id "+data.id;titleIn.value="";qualitiesIn.value=""}catch(e){createMsg.style.color="#fca5a5";createMsg.textContent=e.message}}loginBtn.addEventListener("click",login);logoutBtn.addEventListener("click",()=>setToken(null));whoamiBtn.addEventListener("click",whoami);createBtn.addEventListener("click",createEpisode);updateUI();
